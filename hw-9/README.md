# Продвинутое программирование на PHP — Laravel
## Урок 9. Работа с событиями
### Домашнее задание
<br><br>
Цели практической работы:<br>

Научиться:<br>

— создавать события и вызывать их;<br>
— создавать слушатели и привязывать их к событию;<br>
— применять наблюдатели моделей.<br>

Что нужно сделать:<br>

1. Создайте новый проект Laravel или откройте уже существующий.<br>

2. Создайте новую ветку вашего репозитория от корневой (main или master).<br>

3. Создайте миграцию командой php artisan make:migration CreateNewsTable со следующими полями:<br>
![](../archives/pic-9-1.jpg)<br>
4. Создайте модель News.<br>

5. Создайте событие NewsHidden и присвойте полю класса $news параметр $news в конструкторе класса.<br>
   ![](../archives/pic-9-2.jpg)<br>
6. Создайте слушатель NewsHiddenListener, в котором опишите логику слушателя, используя функцию:<br>
   Log::info(‘News ’ . $event->news->id . ‘ hidden’);.

7. Зарегистрируйте событие и слушатель в классе EventServiceProvider.

8. В файле routes/web.php создайте необходимый маршрут ‘/news/create-test’, использующий метод get для создания тестовой новости, и пропишите логику создания тестовой новости.<br>
   ![](../archives/pic-9-3.jpg)<br>
9. В файле routes/web.php создайте необходимый маршрут, использующий метод get ‘/news/{id}/hide’ для скрытия новости. Измените атрибут is_hidden на значение true. После этой операции вызовите событие NewsHidden с помощью инструкции NewsHidden::dispatch($news);.<br>
   ![](../archives/pic-9-4.jpg)<br>
10. В файле storage/logs/laravel.log проверьте, сработал ли слушатель, в нём должна появиться строка ‘News hidden 1’, где 1 — это id скрытой новости (может отличаться).<br>

11. Создайте класс-наблюдатель NewsObserver.

12. Зарегистрируйте его в файле App\Providers\EventServiceProvider в функции boot.

13. Опишите логику изменения поля slug новости при вызове события saving в наблюдателе NewsObserver с помощью инструкции.
    ![](../archives/pic-9-5.jpg)<br>
    Эта инструкция использует класс Str, который можно подключить с помощью инструкции в начале файла.
    ![](../archives/pic-9-6.jpg)<br>
14. Создайте ещё одну новость с помощью маршрута ‘/news/create-test’.

15. Проверьте заполнение поля slug через базу данных. Оно должно выглядеть следующим образом: «test-news-title» (если вы оставили такое же название, как в примере).

16. Сделайте коммит изменений с помощью Git и отправьте push в репозиторий.

<br><br><hr>
**В качестве решения приложить:** <br>
➔ ссылку на репозиторий с домашним заданием <br>
⚹ записать необходимые пояснения к выполненному заданию<br>
<hr>

**Критерии оценки работы:** <br>

**Принято:** <br>

— выполнены все пункты работы; <br>
— в работе используются указанные инструменты, соблюдены условия; <br>
— код корректно отформатирован по стандартам программирования на PHP; <br>
— код запускается, выводит данные на экран, не вызывает ошибок. <br>

**На доработку:** <br>
— выполнены не все пункты работы; <br>
— работа выполнена с ошибками. <br>

**Как отправить работу на проверку:** <br>

Отправьте коммит, содержащий код задания, на ветку master в вашем репозитории и пришлите его URL (URL Merge Request’а) через форму. Репозиторий должен быть public.


![PHP Laravel Framework](../archives/i-min.jpg)

<br><br><br>